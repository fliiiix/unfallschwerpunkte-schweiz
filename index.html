<!DOCTYPE html>
<html>
<head>
	<title>Unfallschwerpunkte der Schweiz</title>
	<meta charset="utf-8">
	<script src="https://d3js.org/d3.v5.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js" integrity="sha256-tHoAPGoNdhIR28YHl9DWLzeRfdwigkH7OCBXMrHXhoM=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-hexbin@0.2.2/build/d3-hexbin.min.js"></script>
</head>
<body>
	<svg class="target" />
	<script type="text/javascript">
    const rawdata = JSON.parse(`{
  "type" : "FeatureCollection",
  "name" : "RoadTrafficAccidentLocations_GEOJSON",
  "features" : [
    {
      "type" : "Feature",
      "geometry" : {
        "type" : "Point",
        "coordinates" : [ 8.309470, 47.053167, 0]
      },
      "properties" : {
        "center" : "true"
      }
    }
    ]}`);

    document.addEventListener("DOMContentLoaded", function(){
   	  const width = 960;
      const height = 620;
      const svg = d3.select(".target")
        .attr("viewBox", [0, 0, width, height])
        .attr("width", width)
        .attr("height", height);

      d3.json('/assets/data/ch-cantons-lakes.json').then(function(topodata_ch) {

        const projection = d3.geoMercator()
          .center([8.1336, 46.484])
          .scale(8800)
          .translate([width/2, height/2])
          .precision(.1);

        const geo_path = d3.geoPath().projection(projection);

        //draw basic map
        svg.append("path")
          .datum(topojson.mesh(topodata_ch))
          .attr("fill", "none")
          .attr("stroke", "#777")
          .attr("stroke-width", 0.5)
          .attr("stroke-linejoin", "round")
          .attr("d", geo_path);

        
        d3.json('/assets/data/RoadTrafficAccidentLocations.json').then(function(accident_data) {
          // draw features
          svg.selectAll("circle")
          .data( accident_data.features )
          .enter()
          .append("circle")
          .attr("transform", function(d) {console.log(projection([ d.geometry.coordinates[0], d.geometry.coordinates[1] ])); return "translate(" + projection([ d.geometry.coordinates[0], d.geometry.coordinates[1] ]) + ")";})
          .attr("r", function(d) {
            if(d.properties.AccidentSeverityCategory == "as1"){
              return "2px";
            }
            else{
              return "1px";
            }
            })
          .attr("fill", function(d) {
            if(d.properties.AccidentSeverityCategory == "as1"){
              return "red";
            }
            if(d.properties.AccidentSeverityCategory == "as2"){
              return "orange";
            }
            if(d.properties.AccidentSeverityCategory == "as3"){
              return "green";
            }
           });

          // draw see
          svg.selectAll("path")
            .data(topojson.feature(topodata_ch, topodata_ch.objects.lakes).features)
            .enter()
            .append("path")
            .attr("d", geo_path)
            .style("fill", "#002366");
        });  
	    });
    });
	</script>
</body>
</html>